Утилита для извлечения пар СНИЛС + Фамилия из структуры каталогов с файлами.

## Описание

Этот инструмент сканирует структуру каталогов и извлекает пары "СНИЛС + Фамилия" из:
- Имен файлов (первое кириллическое слово, похожее на фамилию)
- Excel файлов с именем "Персональные данные.xlsx" (ячейка B2, первое слово как фамилия)
- Каталогов с именами в формате 11-значного СНИЛС

Также создается список всех найденных СНИЛС, включая те, для которых не удалось определить фамилию.

## Особенности

- **Обнаружение СНИЛС**: Поиск 11-значных номеров в путях файлов, именах файлов и каталогах
- **Извлечение фамилий**: Умное определение фамилий из кириллических слов с исключением медицинских терминов
- **Поддержка Excel**: Чтение ячейки B2 из файлов "Персональные данные.xlsx"
- **Фильтрация**: Автоматическое исключение медицинских терминов (Антропометрия, Маммография и др.)
- **Обработка каталогов**: Сканирование каталогов с именами в формате СНИЛС
- **Дедупликация**: Автоматическое удаление дубликатов
- **Полный охват**: Включение СНИЛС без фамилий в итоговый список
- **Сортировка**: Результаты отсортированы по СНИЛС, затем по фамилии

## Установка

1. Клонировать репозиторий:
```bash
git clone <repository-url>
cd dispa
```

2. Установить зависимости:
```bash
pip install -r requirements.txt
```

## Использование

### Базовое использование

```bash
python scripts/extract_snils_surnames.py
```

Сканирует текущий каталог и создает файлы в папке `scripts/`:
- `scripts/all_paths.txt` - список всех найденных файлов
- `scripts/snils_surnames.txt` - пары СНИЛС + Фамилия и отдельные СНИЛС

### Расширенное использование

```bash
python scripts/extract_snils_surnames.py /path/to/scan --paths custom_paths.txt --out custom_results.txt
```

### Параметры командной строки

- `ROOT_DIR` - Корневой каталог для сканирования (по умолчанию: текущий каталог)
- `--paths OUT1` - Файл для списка всех путей (по умолчанию: `scripts/all_paths.txt`)
- `--out OUT2` - Файл для результатов СНИЛС+Фамилия (по умолчанию: `scripts/snils_surnames.txt`)

## Формат вывода

Файл результатов содержит:
- СНИЛС с фамилиями (по одной паре на строку)
- СНИЛС без фамилий (только номер на строку)

Пример:
```
00892112570 Иванов
00891112570 Смирнов
05325487162 Сидоров
12345678901
98765432109
```

## Алгоритм извлечения фамилий

1. **Из имен файлов**:
   - Поиск первого кириллического слова, за которым следует другое имя или инициалы
   - Предпочтение словам в ВЕРХНЕМ РЕГИСТРЕ или с Заглавной буквой
   - Минимальная длина: 3 символа
   - Исключение медицинских терминов и нежелательных записей

2. **Из Excel файлов**:
   - Чтение ячейки B2 из файлов "Персональные данные.xlsx"
   - Извлечение первого слова как фамилии

3. **Обработка каталогов**:
   - Автоматическое определение каталогов с именами в формате 11-значного СНИЛС
   - Включение всех найденных СНИЛС в итоговый список

## Исключаемые термины

Скрипт автоматически исключает следующие медицинские термины и нежелательные записи:
- Антропометрия
- Артериальное  
- Внутриглазное
- Маммография
- Персональные
- Рентгенография
- Электрокардиография
- Анкета
- Записи с СНИЛС "00000000000" (фальшивые номера)

## Требования

- Python 3.6+
- openpyxl (для работы с Excel файлами)

## Примеры структуры файлов

Скрипт может обрабатывать такие структуры:
```
/data/
  12345678901/
    Иванов_И_И_документ.pdf
    Персональные данные.xlsx
  98765432109/
    ПЕТРОВА_А_В_справка.docx
```

Результат:
```
12345678901 Иванов
98765432109 Петрова
```

## Дополнительные возможности

### Работа с виртуальными средами Python

Скрипт может работать в виртуальной среде Python:

1. Создание виртуальной среды:
```bash
python -m venv .venv
```

2. Активация (Windows):
```bash
.venv\Scripts\activate
```

3. Установка зависимостей:
```bash
pip install -r requirements.txt
```

4. Запуск скрипта:
```bash
python scripts/extract_snils_surnames.py
```

### Мониторинг выполнения

Скрипт выводит информационные сообщения о ходе выполнения:
- Количество найденных каталогов СНИЛС
- Предупреждения об отсутствующих зависимостях
- Количество обработанных файлов и извлеченных пар

## Замечания

- Если библиотека `openpyxl` не установлена, извлечение из Excel файлов будет пропущено с предупреждением
- СНИЛС определяется как последовательность из ровно 11 цифр
- Поддерживаются файлы с расширениями .xlsx и .xslx (учитывая возможные опечатки)
- Выходные файлы создаются в папке `scripts/` относительно местоположения скрипта
- Автоматически исключаются записи с фальшивыми СНИЛС (все нули)
- Медицинские термины и другие нежелательные записи исключаются из результатов
